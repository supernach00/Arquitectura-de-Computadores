<!DOCTYPE html>
<!-- saved from url=(0043)https://gbdev.io/pandocs/Audio_details.html -->
<html lang="en" class="navy" dir="ltr"><script async="" src="./Diagrama LFSR_files/matomo.js.descarga"></script><script async="false" type="text/javascript" src="chrome-extension://kjmoohlgokccodicjjfebfomlbljgfhk/in-page.js"></script><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <!-- Book generated using mdBook -->
        
        <title>Audio Details - Pan Docs</title>


        <!-- Custom HTML head -->
        <!-- Open Graph tags-->
        <meta name="og:site_name" content="Pan Docs">
        <meta name="og:image" content="https://gbdev.io/pandocs/favicon.png">
        <meta name="og:title" content="Audio Details">
        <meta name="og:description" content="The single, most comprehensive technical reference to Game Boy available to the public.">
        
        <!-- Twitter meta tags -->
        <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@gbdev0">
        
        <!-- MathML polyfill for Chrome -->
        <script src="./Diagrama LFSR_files/mspace.js.descarga"></script>
        
        <!-- Matomo tracking code -->
        <script>
          var _paq = window._paq = window._paq || [];
          /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
          _paq.push(['trackPageView']);
          _paq.push(['enableLinkTracking']);
          (function() {
            var u="//stats.gbdev.io/";
            _paq.push(['setTrackerUrl', u+'matomo.php']);
            _paq.push(['setSiteId', '1']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
          })();
        </script>
        <!-- End Matomo Code -->

        <meta name="description" content="The single, most comprehensive technical reference to Game Boy available to the public.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="rgb(22, 25, 35)">

        <link rel="icon" href="https://gbdev.io/pandocs/favicon.svg">
        <link rel="shortcut icon" href="https://gbdev.io/pandocs/favicon.png">
        <link rel="stylesheet" href="./Diagrama LFSR_files/variables.css">
        <link rel="stylesheet" href="./Diagrama LFSR_files/general.css">
        <link rel="stylesheet" href="./Diagrama LFSR_files/chrome.css">
        <link rel="stylesheet" href="./Diagrama LFSR_files/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="./Diagrama LFSR_files/font-awesome.css">
        <link rel="stylesheet" href="./Diagrama LFSR_files/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="./Diagrama LFSR_files/highlight.css" disabled="">
        <link rel="stylesheet" href="./Diagrama LFSR_files/tomorrow-night.css">
        <link rel="stylesheet" href="./Diagrama LFSR_files/ayu-highlight.css" disabled="">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="./Diagrama LFSR_files/style.css">

    </head>
    <body class="js sidebar-visible">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents" aria-hidden="false">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><a href="https://gbdev.io/pandocs/About.html" tabindex="0">Foreword</a></li><li class="chapter-item affix "><a href="https://gbdev.io/pandocs/Authors.html" tabindex="0">Acknowledgements</a></li><li class="chapter-item affix "><a href="https://gbdev.io/pandocs/History.html" tabindex="0">History</a></li><li class="chapter-item affix "></li><li class="spacer"></li><li class="chapter-item affix "></li><li class="part-title">Overview</li><li class="chapter-item "><a href="https://gbdev.io/pandocs/Specifications.html" tabindex="0"><strong aria-hidden="true">1.</strong> Specifications</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/Memory_Map.html" tabindex="0"><strong aria-hidden="true">2.</strong> Memory Map</a></li><li class="chapter-item affix "></li><li class="part-title">I/O Ports</li><li class="chapter-item "><a href="https://gbdev.io/pandocs/Hardware_Reg_List.html" tabindex="0"><strong aria-hidden="true">3.</strong> Summary</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/Graphics.html" tabindex="0"><strong aria-hidden="true">4.</strong> Graphics</a><a class="toggle" tabindex="0"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="https://gbdev.io/pandocs/Tile_Data.html" tabindex="0"><strong aria-hidden="true">4.1.</strong> Tile Data</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/Tile_Maps.html" tabindex="0"><strong aria-hidden="true">4.2.</strong> Tile Maps</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/OAM.html" tabindex="0"><strong aria-hidden="true">4.3.</strong> OAM</a><a class="toggle" tabindex="0"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="https://gbdev.io/pandocs/OAM_DMA_Transfer.html" tabindex="0"><strong aria-hidden="true">4.3.1.</strong> OAM DMA Transfer</a></li></ol></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/LCDC.html" tabindex="0"><strong aria-hidden="true">4.4.</strong> LCD Control</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/STAT.html" tabindex="0"><strong aria-hidden="true">4.5.</strong> LCD Status Registers</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/Scrolling.html" tabindex="0"><strong aria-hidden="true">4.6.</strong> Scrolling</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/Palettes.html" tabindex="0"><strong aria-hidden="true">4.7.</strong> Palettes</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/Rendering.html" tabindex="0"><strong aria-hidden="true">4.8.</strong> Rendering</a><a class="toggle" tabindex="0"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="https://gbdev.io/pandocs/pixel_fifo.html" tabindex="0"><strong aria-hidden="true">4.8.1.</strong> Pixel FIFO</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="https://gbdev.io/pandocs/Audio.html" tabindex="0"><strong aria-hidden="true">5.</strong> Audio</a><a class="toggle" tabindex="0"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="https://gbdev.io/pandocs/Audio_Registers.html" tabindex="0"><strong aria-hidden="true">5.1.</strong> Audio Registers</a></li><li class="chapter-item expanded "><a href="https://gbdev.io/pandocs/Audio_details.html" class="active" tabindex="0"><strong aria-hidden="true">5.2.</strong> Audio Details</a></li></ol></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/Joypad_Input.html" tabindex="0"><strong aria-hidden="true">6.</strong> Joypad Input</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/Serial_Data_Transfer_(Link_Cable).html" tabindex="0"><strong aria-hidden="true">7.</strong> Serial Data Transfer</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/Timer_and_Divider_Registers.html" tabindex="0"><strong aria-hidden="true">8.</strong> Timer and Divider Registers</a><a class="toggle" tabindex="0"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="https://gbdev.io/pandocs/Timer_Obscure_Behaviour.html" tabindex="0"><strong aria-hidden="true">8.1.</strong> Timer Obscure Behaviour</a></li></ol></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/Interrupts.html" tabindex="0"><strong aria-hidden="true">9.</strong> Interrupts</a><a class="toggle" tabindex="0"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="https://gbdev.io/pandocs/Interrupt_Sources.html" tabindex="0"><strong aria-hidden="true">9.1.</strong> Interrupt Sources</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/halt.html" tabindex="0"><strong aria-hidden="true">9.2.</strong> HALT</a></li></ol></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/CGB_Registers.html" tabindex="0"><strong aria-hidden="true">10.</strong> CGB Registers</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/IR.html" tabindex="0"><strong aria-hidden="true">11.</strong> Infrared Communication</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/SGB_Functions.html" tabindex="0"><strong aria-hidden="true">12.</strong> SGB Functions</a><a class="toggle" tabindex="0"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="https://gbdev.io/pandocs/SGB_Unlocking.html" tabindex="0"><strong aria-hidden="true">12.1.</strong> Unlocking and Detecting SGB Functions</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/SGB_Command_Packet.html" tabindex="0"><strong aria-hidden="true">12.2.</strong> Command Packet Transfers</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/SGB_VRAM_Transfer.html" tabindex="0"><strong aria-hidden="true">12.3.</strong> VRAM Transfers</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/SGB_Color_Palettes.html" tabindex="0"><strong aria-hidden="true">12.4.</strong> Color Palettes Overview</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/SGB_Command_Summary.html" tabindex="0"><strong aria-hidden="true">12.5.</strong> Command Summary</a><a class="toggle" tabindex="0"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="https://gbdev.io/pandocs/SGB_Command_Palettes.html" tabindex="0"><strong aria-hidden="true">12.5.1.</strong> Palette Commands</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/SGB_Command_Attribute.html" tabindex="0"><strong aria-hidden="true">12.5.2.</strong> Color Attribute Commands</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/SGB_Command_Sound.html" tabindex="0"><strong aria-hidden="true">12.5.3.</strong> Sound Functions</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/SGB_Command_System.html" tabindex="0"><strong aria-hidden="true">12.5.4.</strong> System Control Commands</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/SGB_Command_Multiplayer.html" tabindex="0"><strong aria-hidden="true">12.5.5.</strong> Multiplayer Command</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/SGB_Command_Border.html" tabindex="0"><strong aria-hidden="true">12.5.6.</strong> Border and OBJ Commands</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/SGB_Command_Undocumented.html" tabindex="0"><strong aria-hidden="true">12.5.7.</strong> Undocumented SGB commands</a></li></ol></li></ol></li><li class="chapter-item "></li><li class="part-title">CPU Specifications</li><li class="chapter-item "><a href="https://gbdev.io/pandocs/CPU_Registers_and_Flags.html" tabindex="0"><strong aria-hidden="true">13.</strong> CPU Registers and Flags</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/CPU_Instruction_Set.html" tabindex="0"><strong aria-hidden="true">14.</strong> CPU Instruction Set</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/CPU_Comparison_with_Z80.html" tabindex="0"><strong aria-hidden="true">15.</strong> CPU Comparison with Z80</a></li><li class="chapter-item affix "></li><li class="part-title">Cartridges</li><li class="chapter-item "><a href="https://gbdev.io/pandocs/The_Cartridge_Header.html" tabindex="0"><strong aria-hidden="true">16.</strong> The Cartridge Header</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/MBCs.html" tabindex="0"><strong aria-hidden="true">17.</strong> MBCs</a><a class="toggle" tabindex="0"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="https://gbdev.io/pandocs/nombc.html" tabindex="0"><strong aria-hidden="true">17.1.</strong> No MBC</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/MBC1.html" tabindex="0"><strong aria-hidden="true">17.2.</strong> MBC1</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/MBC2.html" tabindex="0"><strong aria-hidden="true">17.3.</strong> MBC2</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/MBC3.html" tabindex="0"><strong aria-hidden="true">17.4.</strong> MBC3</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/MBC5.html" tabindex="0"><strong aria-hidden="true">17.5.</strong> MBC5</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/MBC6.html" tabindex="0"><strong aria-hidden="true">17.6.</strong> MBC6</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/MBC7.html" tabindex="0"><strong aria-hidden="true">17.7.</strong> MBC7</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/MMM01.html" tabindex="0"><strong aria-hidden="true">17.8.</strong> MMM01</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/M161.html" tabindex="0"><strong aria-hidden="true">17.9.</strong> M161</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/HuC1.html" tabindex="0"><strong aria-hidden="true">17.10.</strong> HuC1</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/HuC3.html" tabindex="0"><strong aria-hidden="true">17.11.</strong> HuC-3</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/othermbc.html" tabindex="0"><strong aria-hidden="true">17.12.</strong> Other MBCs</a></li></ol></li><li class="chapter-item "></li><li class="part-title">Accessories</li><li class="chapter-item "><a href="https://gbdev.io/pandocs/Gameboy_Printer.html" tabindex="0"><strong aria-hidden="true">18.</strong> Game Boy Printer</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/Gameboy_Camera.html" tabindex="0"><strong aria-hidden="true">19.</strong> Game Boy Camera</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/Four_Player_Adapter.html" tabindex="0"><strong aria-hidden="true">20.</strong> 4-Player Adapter</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/Shark_Cheats.html" tabindex="0"><strong aria-hidden="true">21.</strong> Game Genie/Shark Cheats</a></li><li class="chapter-item affix "></li><li class="part-title">Other</li><li class="chapter-item "><a href="https://gbdev.io/pandocs/Power_Up_Sequence.html" tabindex="0"><strong aria-hidden="true">22.</strong> Power-Up Sequence</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/Reducing_Power_Consumption.html" tabindex="0"><strong aria-hidden="true">23.</strong> Reducing Power Consumption</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/Accessing_VRAM_and_OAM.html" tabindex="0"><strong aria-hidden="true">24.</strong> Accessing VRAM and OAM</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/OAM_Corruption_Bug.html" tabindex="0"><strong aria-hidden="true">25.</strong> OAM Corruption Bug</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/External_Connectors.html" tabindex="0"><strong aria-hidden="true">26.</strong> External Connectors</a></li><li class="chapter-item "><a href="https://gbdev.io/pandocs/GBC_Approval_Process.html" tabindex="0"><strong aria-hidden="true">27.</strong> GBC Approval Process</a></li><li class="chapter-item affix "></li><li class="spacer"></li><li class="chapter-item affix "><a href="https://gbdev.io/pandocs/References.html" tabindex="0">References</a></li><li class="chapter-item affix "><a href="https://gbdev.io/pandocs/single.html" tabindex="0">Single-page version</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar bordered" style="top: 4300.03px;">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar" aria-expanded="true">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme theme-selected" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Pan Docs</h1>

                    <div class="right-buttons">
                        <a href="https://gbdev.io/pandocs/print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/gbdev/pandocs" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/gbdev/pandocs/edit/master/src/Audio_details.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="audio-details"><a class="header" href="https://gbdev.io/pandocs/Audio_details.html#audio-details">Audio Details</a></h1>
<p>tl;dr:</p>
<blockquote>
<p>The PPU is a bunch of state machines, and the APU is a bunch of counters.</p>
</blockquote>
<!-- Styles in <svg> tags apply to the whole page, and we have two on this one. Hoist this to be less confusing. -->
<style>
  text {
    fill: var(--fg);
    dominant-baseline: middle;
    font-size: .6em;
  }
  #dsg { font-size: 1em; }
  .centered { text-anchor: middle; }
  .right    { text-anchor: end; }
  .tabnum { font-feature-settings: "tnum"; }
  svg > rect, svg > use {
    stroke: var(--fg);
    fill: var(--fg);
  }
  svg > path, svg > circle {
    stroke: var(--fg);
    fill: none;
  }
  .dashed { stroke-dasharray: 2; }
  .opa50 { opacity: .5; }
  .fill50 { fill-opacity: .5; }
  .digital   { stroke: #df0000; fill: #df0000; }
  .analog    { stroke: #005f98; fill: #005f98; }
  .misc_data { stroke: #a4269c; fill: #a4269c; }
  .dac_ena   { stroke: #ffa700; fill: #ffa700; }
  .ch_active { stroke: #17cc00; fill: #17cc00; }
  rect.legend { width: 5px; height: 5px; }
  text.legend { font-size: .7em; }
  .arrow { stroke-width: 2px; opacity: .35; }
  .unfilled {
    fill: none;
  }
  .no-stroke {
    stroke: none;
  }
</style>
<figure>
<svg viewBox="115 99 470 390" preserveAspectRatio="xMidYMid meet">
  <defs>
    <path d="M 0,-2
             v 4
             l 4,-2
             z" id="arrow-head"></path>
  </defs>
  <rect x="570" y="110" class="legend digital"></rect>
  <text x="565" y="113" class="legend right">Digital waveform</text>
  <rect x="570" y="125" class="legend analog"></rect>
  <text x="565" y="128" class="legend right">Analog waveform</text>
  <rect x="570" y="140" class="legend misc_data"></rect>
  <text x="565" y="143" class="legend right">Misc. digital data</text>
  <rect x="570" y="155" class="legend dac_ena"></rect>
  <text x="565" y="158" class="legend right">DAC enable flag</text>
  <rect x="570" y="170" class="legend ch_active"></rect>
  <text x="565" y="173" class="legend right">Channel active flag</text>
  <rect x="150" y="100" width="230" height="275" class="unfilled opa50"></rect>
  <text x="265" y="118" id="dsg" class="centered">Digital Sound Generator</text>
  <rect x="160" y="140" width="150" height="20" class="unfilled"></rect>
  <text x="235" y="151" class="centered tabnum">Channel 1</text>
  <rect x="160" y="160" width="30" height="20" class="unfilled"></rect>
  <text x="175" y="172" class="centered tabnum">NR10</text>
  <rect x="190" y="160" width="30" height="20" class="unfilled"></rect>
  <text x="205" y="172" class="centered tabnum">NR11</text>
  <rect x="220" y="160" width="30" height="20" class="unfilled"></rect>
  <text x="235" y="172" class="centered tabnum">NR12</text>
  <rect x="250" y="160" width="30" height="20" class="unfilled"></rect>
  <text x="265" y="172" class="centered tabnum">NR13</text>
  <rect x="280" y="160" width="30" height="20" class="unfilled"></rect>
  <text x="295" y="172" class="centered tabnum">NR14</text>
  <rect x="160" y="190" width="150" height="20" class="unfilled"></rect>
  <text x="235" y="201" class="centered tabnum">Channel 2</text>
  <rect x="160" y="210" width="30" height="20" class="fill50"></rect>
  <rect x="190" y="210" width="30" height="20" class="unfilled"></rect>
  <text x="205" y="222" class="centered tabnum">NR21</text>
  <rect x="220" y="210" width="30" height="20" class="unfilled"></rect>
  <text x="235" y="222" class="centered tabnum">NR22</text>
  <rect x="250" y="210" width="30" height="20" class="unfilled"></rect>
  <text x="265" y="222" class="centered tabnum">NR23</text>
  <rect x="280" y="210" width="30" height="20" class="unfilled"></rect>
  <text x="295" y="222" class="centered tabnum">NR24</text>
  <rect x="160" y="240" width="150" height="20" class="unfilled"></rect>
  <text x="235" y="251" class="centered tabnum">Channel 3</text>
  <rect x="160" y="260" width="30" height="20" class="unfilled"></rect>
  <text x="175" y="272" class="centered tabnum">NR30</text>
  <rect x="190" y="260" width="30" height="20" class="unfilled"></rect>
  <text x="205" y="272" class="centered tabnum">NR31</text>
  <rect x="220" y="260" width="30" height="20" class="unfilled"></rect>
  <text x="235" y="272" class="centered tabnum">NR32</text>
  <rect x="250" y="260" width="30" height="20" class="unfilled"></rect>
  <text x="265" y="272" class="centered tabnum">NR33</text>
  <rect x="280" y="260" width="30" height="20" class="unfilled"></rect>
  <text x="295" y="272" class="centered tabnum">NR34</text>
  <rect x="160" y="290" width="150" height="20" class="unfilled"></rect>
  <text x="235" y="301" class="centered tabnum">Channel 4</text>
  <rect x="160" y="310" width="30" height="20" class="fill50"></rect>
  <rect x="190" y="310" width="30" height="20" class="unfilled"></rect>
  <text x="205" y="322" class="centered tabnum">NR41</text>
  <rect x="220" y="310" width="30" height="20" class="unfilled"></rect>
  <text x="235" y="322" class="centered tabnum">NR42</text>
  <rect x="250" y="310" width="30" height="20" class="unfilled"></rect>
  <text x="265" y="322" class="centered tabnum">NR43</text>
  <rect x="280" y="310" width="30" height="20" class="unfilled"></rect>
  <text x="295" y="322" class="centered tabnum">NR44</text>
  <rect x="340" y="148" width="30" height="20" class="unfilled"></rect>
  <text x="355" y="160" class="centered tabnum">NR50</text>
  <rect x="340" y="183" width="30" height="20" class="unfilled"></rect>
  <text x="355" y="195" class="centered tabnum">NR51</text>
  <rect x="340" y="218" width="30" height="20" class="unfilled"></rect>
  <text x="355" y="230" class="centered tabnum">NR52</text>
  <rect x="185" y="350" width="40" height="20" class="unfilled"></rect>
  <text x="205" y="362" class="centered tabnum">PCM12</text>
  <rect x="245" y="350" width="40" height="20" class="unfilled"></rect>
  <text x="265" y="362" class="centered tabnum">PCM34</text>
  <rect x="140" y="430" width="40" height="30" class="unfilled"></rect>
  <text x="160" y="446" class="centered tabnum">DAC 1</text>
  <rect x="190" y="430" width="40" height="30" class="unfilled"></rect>
  <text x="210" y="446" class="centered tabnum">DAC 2</text>
  <rect x="240" y="430" width="40" height="30" class="unfilled"></rect>
  <text x="260" y="446" class="centered tabnum">DAC 3</text>
  <rect x="290" y="430" width="40" height="30" class="unfilled"></rect>
  <text x="310" y="446" class="centered tabnum">DAC 4</text>
  <rect x="370" y="430" width="40" height="30" class="unfilled"></rect>
  <text x="390" y="446" class="centered tabnum">Mixer</text>
  <rect x="430" y="430" width="40" height="30" class="unfilled"></rect>
  <text x="450" y="446" class="centered tabnum">Volume</text>
  <rect x="490" y="420" width="30" height="20" class="unfilled"></rect>
  <text x="505" y="431" class="centered tabnum">HPF</text>
  <rect x="490" y="450" width="30" height="20" class="unfilled"></rect>
  <text x="505" y="461" class="centered tabnum">HPF</text>
  <rect x="540" y="430" width="40" height="30" class="unfilled"></rect>
  <text x="560" y="446" class="centered tabnum">Out</text>
  <!-- Keep in mind that later things are drawn over earlier ones. Order matters! -->
  <path d="M 235,180
           v 5
           h -115
           v 230
           h 30
           v 11" class="dac_ena unfilled"></path>
  <use x="150" y="426" href="#arrow-head" class="dac_ena" transform="rotate(90,150,426)"></use>
  <path d="M 235,230
           v 5
           h -100
           v 165
           h 65
           v 26" class="dac_ena unfilled"></path>
  <use x="200" y="426" href="#arrow-head" class="dac_ena" transform="rotate(90,200,426)"></use>
  <path d="M 175,280
           v 5
           h -20
           v 100
           h 95
           v 41" class="dac_ena unfilled"></path>
  <use x="250" y="426" href="#arrow-head" class="dac_ena" transform="rotate(90,250,426)"></use>
  <path d="M 235,330
           v 5
           h 65
           v 91" class="dac_ena unfilled"></path>
  <use x="300" y="426" href="#arrow-head" class="dac_ena" transform="rotate(90,300,426)"></use>
  <path d="M 160,150
           h -35
           v 32
           a 8 4 0 0 1 0,6
           v 222
           h 45
           v 16" class="digital unfilled"></path>
  <use x="170" y="426" href="#arrow-head" class="digital" transform="rotate(90,170,426)"></use>
  <path d="M 181,355
           h -23
           a 4 8 0 0 0 -6,0
           h -14
           a 4 8 0 0 0 -6,0
           h -7" class="digital unfilled"></path>
  <use x="181" y="355" href="#arrow-head" class="digital"></use>
  <path d="M 160,200
           h -20
           v 32
           a 8 4 0 0 1 0,6
           v 114
           a 8 4 0 0 1 0,6
           v 37
           h 80
           v 31" class="digital unfilled"></path>
  <use x="220" y="426" href="#arrow-head" class="digital" transform="rotate(90,220,426)"></use>
  <path d="M 181,365
           h -23
           a 4 8 0 0 0 -6,0
           h -12" class="digital unfilled"></path>
  <use x="181" y="365" href="#arrow-head" class="digital"></use>
  <path d="M 310,254
           h 25
           v 131
           h -12
           a 4 8 0 0 0 -6,0
           h -14
           a 4 8 0 0 0 -6,0
           h -27
           v 41" class="digital unfilled"></path>
  <use x="270" y="426" href="#arrow-head" class="digital" transform="rotate(90,270,426)"></use>
  <path d="M 289,355
           h 8
           a 4 8 0 0 1 6,0
           h 14
           a 4 8 0 0 1 6,0
           h 12" class="digital unfilled"></path>
  <use x="289" y="355" href="#arrow-head" class="digital" transform="rotate(-180,289,355)"></use>
  <path d="M 310,304
           h 10
           v 122" class="digital unfilled"></path>
  <use x="320" y="426" href="#arrow-head" class="digital" transform="rotate(90,320,426)"></use>
  <path d="M 289,365
           h 8
           a 4 8 0 0 1 6,0
           h 17" class="digital unfilled"></path>
  <use x="289" y="365" href="#arrow-head" class="digital" transform="rotate(-180,289,365)"></use>
  <path d="M 310,150
           h 18
           v 73
           h 8" class="ch_active unfilled"></path>
  <use x="336" y="223" href="#arrow-head" class="ch_active"></use>
  <path d="M 310,200
           h 8
           v 33
           h 18" class="ch_active unfilled"></path>
  <use x="336" y="233" href="#arrow-head" class="ch_active"></use>
  <path d="M 310,246
           h 40
           v -3" class="ch_active unfilled"></path>
  <use x="350" y="243" href="#arrow-head" class="ch_active" transform="rotate(-90,350,243)"></use>
  <path d="M 310,296
           h 22
           a 4 8 0 0 1 6,0
           h 22
           v -53" class="ch_active unfilled"></path>
  <use x="360" y="243" href="#arrow-head" class="ch_active" transform="rotate(-90,360,243)"></use>
  <path d="M 310,460
           v 10
           h 31
           v -37
           h 25" class="analog unfilled"></path>
  <use x="366" y="433" href="#arrow-head" class="analog"></use>
  <path d="M 260,460
           v 15
           h 86
           v -34
           h 20" class="analog unfilled"></path>
  <use x="366" y="441" href="#arrow-head" class="analog"></use>
  <path d="M 210,460
           v 20
           h 141
           v -31
           h 15" class="analog unfilled"></path>
  <use x="366" y="449" href="#arrow-head" class="analog"></use>
  <path d="M 160,460
           v 25
           h 196
           v -28
           h 10" class="analog unfilled"></path>
  <use x="366" y="457" href="#arrow-head" class="analog"></use>
  <path d="M 410,438
           h 16" class="analog unfilled"></path>
  <use x="426" y="438" href="#arrow-head" class="analog"></use>
  <path d="M 410,452
           h 16" class="analog unfilled"></path>
  <use x="426" y="452" href="#arrow-head" class="analog"></use>
  <path d="M 470,438
           h 8
           v -8
           h 8" class="analog unfilled"></path>
  <use x="486" y="430" href="#arrow-head" class="analog"></use>
  <path d="M 470,452
           h 8
           v 8
           h 8" class="analog unfilled"></path>
  <use x="486" y="460" href="#arrow-head" class="analog"></use>
  <path d="M 520,430
           h 8
           v 8
           h 8" class="analog unfilled"></path>
  <use x="536" y="438" href="#arrow-head" class="analog"></use>
  <path d="M 520,460
           h 8
           v -8
           h 8" class="analog unfilled"></path>
  <use x="536" y="452" href="#arrow-head" class="analog"></use>
  <path d="M 370,193
           h 20
           v 233" class="misc_data unfilled"></path>
  <use x="390" y="426" href="#arrow-head" class="misc_data" transform="rotate(90,390,426)"></use>
  <path d="M 370,158
           h 30
           v 248
           h 50
           v 20" class="misc_data unfilled"></path>
  <use x="450" y="426" href="#arrow-head" class="misc_data" transform="rotate(90,450,426)"></use>
</svg>
<figcaption>Source: Lior "LIJI32" Halphon</figcaption>
</figure>
<p>Each of the four “conceptual” channels is composed of a “generation” circuit (designated “channel” in the above diagram), and a <a href="https://en.wikipedia.org/wiki/Digital-to-analog_converter">DAC</a>.
The digital value produced by the generator, which ranges between $0 and $F (0 and 15), is linearly translated by the DAC into an analog<sup class="footnote-reference"><a href="https://gbdev.io/pandocs/Audio_details.html#digital_analog">1</a></sup> value between -1 and 1 (the unit is arbitrary).</p>
<p>The four analog channel outputs are then fed into the mixer<sup class="footnote-reference"><a href="https://gbdev.io/pandocs/Audio_details.html#vin">2</a></sup>, which selectively adds them (depending on <a href="https://gbdev.io/pandocs/Audio_Registers.html#ff25--nr51-sound-panning"><code class="hljs language-undefined">NR51</code></a>) into two analog outputs (Left and Right).
Thus, the analog range of those outputs is 4× that of each channel, -4 to 4.</p>
<p>Then, both of these two get their respective volume scaled, once from <a href="https://gbdev.io/pandocs/Audio_Registers.html#ff24--nr50-master-volume--vin-panning"><code class="hljs language-undefined">NR50</code></a>, and once from the volume knob (if the console has one).
Note that the former step never mutes a non-silent input, but the latter can.</p>
<p>Each of the two analog outputs then goes through a <a href="https://en.wikipedia.org/wiki/High-pass_filter">high-pass filter</a> (HPF).
For short, a HPF constantly tries to “pull” the signal towards analog 0 (neutral); the reason for that is explained further below.</p>
<div class="footnote-definition" id="digital_analog"><sup class="footnote-definition-label">1</sup>
<p>To be clear: digital values are discrete and clear-cut; conversely, the analog domain is continuous.
The former is what computers use, the latter is what the real world is made of.</p>
</div>
<div class="footnote-definition" id="vin"><sup class="footnote-definition-label">2</sup>
<p>Actually, VIN acts as a 5<sup>th</sup> channel fed into the mixer, whose control bits are in NR50 instead of NR51.
This was omitted from the diagram for simplicity.</p>
</div>
<h2 id="pcm-registers"><a class="header" href="https://gbdev.io/pandocs/Audio_details.html#pcm-registers">PCM registers</a></h2>
<p>These two registers, only present in the Game Boy Color and later models, allow reading the output of the generation circuits directly; this is very useful for testing “internal” APU behavior.
These registers are not documented in any known Nintendo manual.</p>
<h3 id="ff76--pcm12-cgb-mode-only-digital-outputs-1--2-read-only"><a class="header" href="https://gbdev.io/pandocs/Audio_details.html#ff76--pcm12-cgb-mode-only-digital-outputs-1--2-read-only">FF76 — PCM12 (CGB Mode only): Digital outputs 1 &amp; 2 [read-only]</a></h3>
<p>The low nibble is a copy of sound channel 1’s digital output, the high nibble a copy of sound channel 2’s.</p>
<h3 id="ff77--pcm34-cgb-mode-only-digital-outputs-3--4-read-only"><a class="header" href="https://gbdev.io/pandocs/Audio_details.html#ff77--pcm34-cgb-mode-only-digital-outputs-3--4-read-only">FF77 — PCM34 (CGB Mode only): Digital outputs 3 &amp; 4 [read-only]</a></h3>
<p>Same, but with channels 3 and 4.</p>
<h2 id="finer-technical-explanation"><a class="header" href="https://gbdev.io/pandocs/Audio_details.html#finer-technical-explanation">Finer technical explanation</a></h2>
<h3 id="div-apu"><a class="header" href="https://gbdev.io/pandocs/Audio_details.html#div-apu">DIV-APU</a></h3>
<p>A “DIV-APU” counter is increased every time <code class="hljs language-undefined">DIV</code>’s bit 4 (5 in <a href="https://gbdev.io/pandocs/CGB_Registers.html#ff4d--key1-cgb-mode-only-prepare-speed-switch">double-speed mode</a>) goes from 1 to 0, therefore at a frequency of 512 Hz (regardless of whether double-speed is active).
Thus, the counter can be made to increase faster by writing to <code class="hljs language-undefined">DIV</code> while its relevant bit is set (which clears <code class="hljs language-undefined">DIV</code>, and triggers the falling edge).</p>
<p>The following events occur every <var>N</var> DIV-APU ticks:</p>
<div class="table-wrapper"><table><thead><tr><th>Event</th><th>Rate</th><th>Frequency<sup class="footnote-reference"><a href="https://gbdev.io/pandocs/Audio_details.html#div_apu_freq">3</a></sup></th></tr></thead><tbody>
<tr><td>Envelope sweep</td><td>8</td><td>64 Hz</td></tr>
<tr><td>Sound length</td><td>2</td><td>256 Hz</td></tr>
<tr><td>CH1 freq sweep</td><td>4</td><td>128 Hz</td></tr>
</tbody></table>
</div>
<div class="footnote-definition" id="div_apu_freq"><sup class="footnote-definition-label">3</sup>
<p>Indicated values are under normal operation; the frequencies will obviously differ if writing to <code class="hljs language-undefined">DIV</code> to increase the counter faster.</p>
</div>
<h3 id="mixer"><a class="header" href="https://gbdev.io/pandocs/Audio_details.html#mixer">Mixer</a></h3>
<p>A high-pass filter (HPF) removes constant biases over time.
The HPFs therefore remove the DC offset created by inactive channels with an enabled DAC, and off-center waveforms.</p>
<div class="box tip-box"><p class="box-title">Avoiding audio pops</p>
<p>Enabling or disabling a DAC (<a href="https://gbdev.io/pandocs/Audio_details.html#dacs">see below</a>), adding or removing it using NR51, or changing the volume in NR50, will cause an audio pop.
(All of these actions cause a change in DC offset, which is smoothed out by the HPFs over time, but still creates a pop.)</p>
<p>To avoid this, a sound driver should avoid turning the DACs off; this can be done by writing $08 to <code class="hljs language-undefined">NRx2</code> (silences the channel but keeps the DAC on) then $80 to <code class="hljs language-undefined">NRx4</code> to retrigger the channel and reload <code class="hljs language-undefined">NRx2</code>.</p>
</div>
<p>The HPF is more aggressive on GBA than on GBC, which itself is more aggressive than on DMG.
(The more “aggressive” a HPF, the faster it pulls the signal towards “analog 0”; this tends to also distort waveforms.)</p>
<h3 id="dacs"><a class="header" href="https://gbdev.io/pandocs/Audio_details.html#dacs">DACs</a></h3>
<p>Channel <var>x</var>’s DAC is enabled if and only if <code class="hljs language-undefined">[NRx2] &amp; $F8 != 0</code>; the exception is CH3, whose DAC is directly controlled by bit 7 of NR30 instead.
Note that the envelope functionality changes the volume, but not the value stored in NRx2, and thus doesn’t disable the DACs.</p>
<p>If a DAC is enabled, the digital range $0 to $F is linearly translated to the analog range -1 to 1, in arbitrary units.
Importantly, the slope is negative: “digital 0” maps to “analog 1”, not “analog -1”.</p>
<p>If a DAC is disabled, it fades to an analog value of 0, which corresponds to “digital 7.5”.
The nature of this fade is not entirely deterministic and varies between models.</p>
<p>NR52’s low 4 bits report whether the channels are turned on, not their DACs.</p>
<h3 id="channels"><a class="header" href="https://gbdev.io/pandocs/Audio_details.html#channels">Channels</a></h3>
<p>A channel is activated by a write to NRx4’s MSB, unless its DAC is off, which forces it to be disabled as well.
The opposite is not true, however: a disabled channel outputs 0, which an enabled DAC will dutifully convert into “analog 1”.</p>
<p>A channel can be deactivated in one of the following ways:</p>
<ul>
<li>Turning off its DAC</li>
<li>Its <a href="https://gbdev.io/pandocs/Audio.html#length-timer">length timer</a> expiring</li>
<li>(CH1 only) <a href="https://gbdev.io/pandocs/Audio_Registers.html#ff10--nr10-channel-1-sweep">Frequency sweep</a> overflowing the frequency</li>
</ul>
<h3 id="pulse-channel-with-sweep-ch1"><a class="header" href="https://gbdev.io/pandocs/Audio_details.html#pulse-channel-with-sweep-ch1">Pulse channel with sweep (CH1)</a></h3>
<p>The first square channel has a frequency sweep unit, controlled by <code class="hljs language-undefined">NR10</code>. This internally has a “sweep timer”, “enabled flag”,
and a period/frequency “shadow register”. The “enabled flag” controls if the sweep unit is active,
the “sweep timer” is clocked at 128 Hz by the <a href="https://gbdev.io/pandocs/Audio_details.html#div-apu">DIV-APU</a>, and the “shadow register” holds the current output period.</p>
<p>During a <a href="https://gbdev.io/pandocs/Audio.html#triggering">trigger event</a>, several things occur:</p>
<ul>
<li>CH1 <a href="https://gbdev.io/pandocs/Audio_Registers.html#ff13--nr13-channel-1-period-low-write-only">period value</a> is copied to the “shadow register”.</li>
<li>The “sweep timer” is reset.</li>
<li>The “enabled flag” is set if either the <a href="https://gbdev.io/pandocs/Audio_Registers.html#ff10--nr10-channel-1-sweep">sweep pace or individual step</a> are non-zero, cleared otherwise.</li>
<li>If the individual step is non-zero, <em>frequency calculation</em> and <em>overflow check</em> are performed immediately.</li>
</ul>
<p><em>Frequency calculation</em> consists of taking the value in the frequency “shadow register”, shifting it right by the individual step,
optionally negating the value (depending on the <a href="https://gbdev.io/pandocs/Audio_Registers.html#ff10--nr10-channel-1-sweep">direction</a>) and summing this with the frequency
“shadow register” to produce a new frequency.
What is done with this new frequency depends on the context.</p>
<p>The <em>overflow check</em> simply calculates the new frequency and if it is greater than 2047, or $7FF, CH1 is disabled.</p>
<p>When the “sweep timer” is <a href="https://gbdev.io/pandocs/Audio_details.html#div-apu">clocked</a> if the “enabled flag” is set and the sweep pace is not zero,
a new frequency is calculated and the overflow check is performed.
If the new frequency is 2047 or less and the individual step is not zero, this new frequency is written back to the
“shadow register” and CH1 frequency in <code class="hljs language-undefined">NR13</code> and <code class="hljs language-undefined">NR14</code>, then frequency calculation and overflow check
are run <em>again</em> immediately using this new value, but this second new frequency is not written back.</p>
<p>CH1 frequency can be modified via <code class="hljs language-undefined">NR13</code> and <code class="hljs language-undefined">NR14</code> while sweep is active,
but the “shadow register” won’t be affected so the next time the “sweep timer” updates the channel’s frequency,
this modification will be lost. This can be avoided by triggering the channel.</p>
<h3 id="pulse-channels-ch1-ch2"><a class="header" href="https://gbdev.io/pandocs/Audio_details.html#pulse-channels-ch1-ch2">Pulse channels (CH1, CH2)</a></h3>
<p>Each pulse channel has an internal “duty step” counter, which is used to index into <a href="https://gbdev.io/pandocs/Audio_Registers.html#ff11--nr11-channel-1-length-timer--duty-cycle">the selected waveform</a> (each background stripe corresponds to one “duty step”)<sup class="footnote-reference"><a href="https://gbdev.io/pandocs/Audio_details.html#pulse_lut">4</a></sup>.
The “duty step” increments at the channel’s sample rate, which is 8 times <a href="https://gbdev.io/pandocs/Audio_Registers.html#ff13--nr13-channel-1-period-low-write-only">the channel’s frequency</a>).</p>
<p>The “duty step” counter cannot be reset, except by turning the APU off, which sets both back to 0.
Retriggering a pulse channel causes its “duty step timer” to reset, thus retriggering a pulse channel often enough will cause its “duty step” to never advance.</p>
<p>When first starting up a pulse channel, it will <em>always</em> output a (digital) zero.</p>
<div class="footnote-definition" id="pulse_lut"><sup class="footnote-definition-label">4</sup>
<p>Actually, there is not LUT, but the manipulations done to the counter’s bits are equivalent.</p>
</div>
<h3 id="wave-channel-ch3"><a class="header" href="https://gbdev.io/pandocs/Audio_details.html#wave-channel-ch3">Wave channel (CH3)</a></h3>
<p>CH3 has an internal “sample index” counter.
The “sample index” increments at the channel’s sample rate, which is 32 times <a href="https://gbdev.io/pandocs/Audio_Registers.html#ff1d--nr33-channel-3-period-low-write-only">the channel’s frequency</a>
Each time it increments, the corresponding “sample” (nibble) is read from wave RAM.
(This means that sample #0 is skipped when first starting up CH3.)</p>
<p>CH3 does not emit samples directly, but stores every sample read into a buffer, and emits that continuously; (re)triggering the channel does <em>not</em> clear nor refresh this buffer, so the last sample ever read will be emitted again.
This buffer <em>is</em> cleared when turning the APU on, so CH3 will emit a “digital 0” when first powered on.</p>
<p>CH3 output level control does not, in fact, alter the output level.
It shifts the <strong>digital</strong> value CH3 is outputting, not the analog value.
This only matters when changing the setting mid-playback: the digital values being shifted bias them towards 0, which biases the analog output towards “1”; the HPF will smooth this over time, but not instantly.</p>
<h3 id="noise-channel-ch4"><a class="header" href="https://gbdev.io/pandocs/Audio_details.html#noise-channel-ch4">Noise channel (CH4)</a></h3>
<svg viewBox="0 0 322 60" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <path d="M 0,-5
             v 10
             l 10,-5
             z" id="arrow-head"></path>
  </defs>
  <rect x="1" y="10" width="20" height="20" class="unfilled"></rect> <text x="11" y="5" class="centered">15</text>
  <rect x="21" y="10" width="20" height="20" class="unfilled"></rect> <text x="31" y="5" class="centered">14</text>
  <rect x="41" y="10" width="20" height="20" class="unfilled"></rect> <text x="51" y="5" class="centered">13</text>
  <rect x="61" y="10" width="20" height="20" class="unfilled"></rect> <text x="71" y="5" class="centered">12</text>
  <rect x="81" y="10" width="20" height="20" class="unfilled"></rect> <text x="91" y="5" class="centered">11</text>
  <rect x="101" y="10" width="20" height="20" class="unfilled"></rect> <text x="111" y="5" class="centered">10</text>
  <rect x="121" y="10" width="20" height="20" class="unfilled"></rect> <text x="131" y="5" class="centered">9</text>
  <rect x="141" y="10" width="20" height="20" class="unfilled"></rect> <text x="151" y="5" class="centered">8</text>
  <rect x="161" y="10" width="20" height="20" class="unfilled"></rect> <text x="171" y="5" class="centered">7</text>
  <rect x="181" y="10" width="20" height="20" class="unfilled"></rect> <text x="191" y="5" class="centered">6</text>
  <rect x="201" y="10" width="20" height="20" class="unfilled"></rect> <text x="211" y="5" class="centered">5</text>
  <rect x="221" y="10" width="20" height="20" class="unfilled"></rect> <text x="231" y="5" class="centered">4</text>
  <rect x="241" y="10" width="20" height="20" class="unfilled"></rect> <text x="251" y="5" class="centered">3</text>
  <rect x="261" y="10" width="20" height="20" class="unfilled"></rect> <text x="271" y="5" class="centered">2</text>
  <rect x="281" y="10" width="20" height="20" class="unfilled"></rect> <text x="291" y="5" class="centered">1</text>
  <rect x="301" y="10" width="20" height="20" class="unfilled"></rect> <text x="311" y="5" class="centered">0</text>
  <path d="M 311,30
           v 21
           h -30"></path>
  <path d="M 291,30
           v 15
           h -10"></path>
  <path d="M 267,38
           c 0,0 -10,0 -17,10  7,10 17,10 17,10
           h 13
           c -5,-5 -5,-15 0,-20
           z
           m 17,20
           c -5,-5 -5,-15 0,-20"></path>
  <circle cx="248" cy="48" r="2"></circle>
  <path d="M 246,48
           h -235
           v -13"></path> <use x="11" y="35" href="#arrow-head" transform="rotate(-90,11,35)"></use>
  <path d="M 171,48
           v -13" class="dashed"></path> <use x="171" y="35" href="#arrow-head" transform="rotate(-90,171,35)"></use>
</svg>
<p>CH4 revolves around a <a href="https://en.wikipedia.org/wiki/Linear-feedback_shift_register">LFSR</a>, pictured above.
The LFSR has 16 bits: 15 bits for its current state and 1 bit to temporarily store the next bit to shift in.</p>
<p>When CH4 is ticked (at the frequency specified via <a href="https://gbdev.io/pandocs/Audio_Registers.html#ff22--nr43-channel-4-frequency--randomness"><code class="hljs language-undefined">NR43</code></a>):</p>
<ol>
<li>The result of <math><menclose notation="top"><msub><mi>LFSR</mi><mn>0</mn></msub> <mo>⊙</mo> <msub><mi>LFSR</mi><mn>1</mn></msub></menclose></math> (<code class="hljs language-undefined">1</code> if bit 0 and bit 1 are identical, <code class="hljs language-undefined">0</code> otherwise) is written to bit 15.</li>
<li>If “short mode” was selected in <a href="https://gbdev.io/pandocs/Audio_Registers.html#ff22--nr43-channel-4-frequency--randomness"><code class="hljs language-undefined">NR43</code></a>, then bit 15 is copied to bit 7 as well.</li>
<li>Finally, the entire LFSR is shifted right, and bit 0 selects between 0 and <a href="https://gbdev.io/pandocs/Audio_Registers.html#ff21--nr42-channel-4-volume--envelope">the chosen volume</a>.</li>
</ol>
<p>The LFSR is set to 0 when (re)triggering the channel.</p>
<div class="box tip-box"><p class="box-title">Lock-up</p>
<p>If the “active” portion of the LFSR only contains “1” bits, only “1” bits will be generated; this prevents CH4 from ever changing values (until retriggered), essentially silencing it.</p>
<p>This does not happen under regular operation, but can be achieved by switching from 15-bit to 7-bit mode when the LFSR’s bottom 7 bits are all “1“s (which occurs relatively early after triggering the channel, for example).</p>
</div>
<h2 id="game-boy-advance-audio"><a class="header" href="https://gbdev.io/pandocs/Audio_details.html#game-boy-advance-audio">Game Boy Advance audio</a></h2>
<p>The APU was reworked pretty heavily for the GBA, which introduces some slightly different behavior:</p>
<ul>
<li>Instead of mixing being done by analog circuitry, it’s instead done digitally; then, sound is converted to an analog signal and an offset is added (see <code class="hljs language-undefined">SOUNDBIAS</code> in <a href="http://problemkaputt.de/gbatek.htm#gbasoundcontrolregisters">GBATEK</a> for more details).</li>
<li>This also means that the GBA APU has no DACs.
Instead, they are emulated digitally such that a disabled “DAC” behaves like an enabled DAC receiving 0 as its input.</li>
<li>Additionally, CH3’s DAC has its output inverted.
In particular, this causes the channel to emit a loud spike when disabled; therefore, it’s a good idea to “disconnect” the channel using NR51 before accessing wave RAM.</li>
</ul>
<p>None of the additional features (more wave RAM, digital FIFOs, etc.) are available to CGB programs.</p>
<h2 id="obscure-behavior"><a class="header" href="https://gbdev.io/pandocs/Audio_details.html#obscure-behavior">Obscure Behavior</a></h2>
<ul>
<li>The volume envelope and sweep timers treat a period of 0 as 8.</li>
<li>Just after powering on, the first duty step of Ch1 and Ch2 after they are triggered for the first time is played
as if it were 0. Also, the duty cycle clocking is disabled until the first trigger.</li>
<li>When triggering Ch3, the first sample to play is the previous one still in the high nibble of the sample buffer, and the next sample is the second nibble from the wave table. This is because it doesn’t load the first byte on trigger like it <em>should</em>.
The first nibble from the wave table is thus not played until the waveform loops.</li>
<li>When triggering Ch1 and Ch2, the low two bits of the frequency timer are NOT modified.</li>
<li>Extra length clocking occurs when writing to NRx4 when the DIV-APU next step is one that doesn’t clock the length timer. In this case, if the length timer was PREVIOUSLY disabled and now enabled and the length timer is not zero, it is decremented. If this decrement makes it zero and trigger is clear, the channel is disabled. On the CGB-02, the length timer only has to have been disabled before; the current length enable state doesn’t matter. This breaks at least one game (Prehistorik Man), and was fixed on CGB-04 and CGB-05.</li>
<li>If a channel is triggered when the DIV-APU next step is one that doesn’t clock the length timer and the length timer is now enabled and length is being set to 64 (256 for wave channel) because it was previously zero, it is set to 63 instead (255 for wave channel).</li>
<li>If a channel is triggered when the DIV-APU next step will clock the volume envelope, the envelope’s timer is reloaded with one greater than it would have been.</li>
<li>Using a noise channel clock shift of 14 or 15 results in the LFSR receiving no clocks.</li>
<li>Clearing the sweep direction bit in NR10 after at least one sweep calculation has been made using the substraction mode since the last trigger causes the channel to be immediately disabled. This prevents you from having the sweep lower the frequency then raise the frequency without a trigger inbetween.</li>
<li>Triggering the wave channel on the DMG while it reads a sample byte will alter the first four bytes of wave RAM. If the channel was reading one of the first four bytes, the only first byte will be rewritten with the byte being read. If the channel was reading one of the later 12 bytes, the first FOUR bytes of wave RAM will be rewritten with the four aligned bytes that the read was from (bytes 4-7, 8-11, or 12-15); for example if it were reading byte 9 when it was retriggered, the first four bytes would be rewritten with the contents of bytes 8-11. To avoid this corruption you should stop the wave by writing 0 then $80 to NR30 before triggering it again. The game Duck Tales encounters this issue part way through most songs.</li>
<li>“Zombie” mode: the volume can be manually altered while a channel is playing by writing to NRx2. Behavior depends on the old and new values of NRx2, and whether the envlope has stopped automatic updates. The CGB-02 and CGB-04 are the most consistent:
<ul>
<li>If the old envelope period was zero and the envelope is still doing automatic updates, volume is incremented by 1, otherwise if the envelope was in decrease mode, volume is incremented by 2.</li>
<li>If the mode was changed (increase to decrease or decrease to increase), volume is set to 16-volume.</li>
<li>Only the low 4 bits of volume are kept after the above operations.</li>
</ul>
</li>
</ul>
<p>Other models behave differently, especially the DMG units which have crazy behavior in some cases. The only useful consistent behavior is using increase mode with a period of zero in order to increment the volume by 1. That is, write $V8 to NRx2 to set the initial volume to V before triggering the channel, then write $08 to NRx2 to increment the volume as the sound plays (repeat 15 times to decrement the volume by 1). This allows manual volume control on all units tested.</p>
<ul>
<li>When all four channel DACs are off, the master volume units are disconnected from the sound output and the output level becomes 0. When any channel DAC is on, a high-pass filter capacitor is connected which slowly removes any DC component from the signal. The following code applied at 4194304 Hz implements these two behaviors for one of the DMG output channels (unoptimized floating point for clarity):</li>
</ul>
<pre><div class="buttons"><button class="fa fa-copy clip-button" title="Copy to clipboard" aria-label="Copy to clipboard"><i class="tooltiptext"></i></button></div><code class="language-c hljs"><span class="hljs-keyword">static</span> <span class="hljs-type">double</span> capacitor = <span class="hljs-number">0.0</span>;

<span class="hljs-type">double</span> <span class="hljs-title function_">high_pass</span><span class="hljs-params">( <span class="hljs-type">double</span> in, <span class="hljs-type">bool</span> dacs_enabled )</span>
{
     <span class="hljs-type">double</span> out = <span class="hljs-number">0.0</span>;
     <span class="hljs-keyword">if</span> ( dacs_enabled )
     {
         out = in - capacitor;

         <span class="hljs-comment">// capacitor slowly charges to 'in' via their difference</span>
         capacitor = in - out * <span class="hljs-number">0.999958</span>; <span class="hljs-comment">// use 0.998943 for MGB&amp;CGB</span>
     }
     <span class="hljs-keyword">return</span> out;
}
</code></pre>
<p>The charge factor can be calculated for any output sampling rate as 0.999958^(4194304/rate). So if you were applying high_pass() at 44100 Hz, you’d use a charge factor of 0.996.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="https://gbdev.io/pandocs/Audio_Registers.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="https://gbdev.io/pandocs/Joypad_Input.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="https://gbdev.io/pandocs/Audio_Registers.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="https://gbdev.io/pandocs/Joypad_Input.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="./Diagrama LFSR_files/elasticlunr.min.js.descarga"></script>
        <script src="./Diagrama LFSR_files/mark.min.js.descarga"></script>
        <script src="./Diagrama LFSR_files/searcher.js.descarga"></script>

        <script src="./Diagrama LFSR_files/clipboard.min.js.descarga"></script>
        <script src="./Diagrama LFSR_files/highlight.js.descarga"></script>
        <script src="./Diagrama LFSR_files/book.js.descarga"></script>

        <!-- Custom JS scripts -->


    </div>
    

</body></html>